# -*- coding:utf-8 -*-#!/usr/bin/env python# Files: calcSlopeOffset.py#--------------------------------------------------# Description: Calculate slope, offset, and rSquared# of a CSV whose columns are:# Percent of full scale, reference ADC value (V), Beryl LSB (hex), Beryl MSB (hex)#--------------------------------------------------# Jason Brinsfield#--------------------------------------------------# Date: 2017/10/23#--------------------------------------------------import globimport reimport osimport sysimport timeimport mathimport numpydef main():    berylVersion = "A0"    listData = []    file = open(sys.argv[1], 'rb')    # read and discard the first (header) line of each file    header = file.readline()    print header    line = file.readline()    while line:        # print line        listData.append(line.strip())        line = file.readline()    file.close()    # print listData    outputData = numpy.zeros((len(listData), 2))    i = 0    invalid = 0    overflow = 0    for line in listData:        outputData[i][0] = line.split(',')[1]        invalid  += int(line.split(',')[2], 16) & 0x80        overflow += int(line.split(',')[2], 16) & 0x40        resultLSB = int(line.split(',')[2], 16) & 0x0F        resultMSB = int(line.split(',')[3], 16)        rawResult = (resultMSB << 4) | resultLSB        if berylVersion == "A0":            rawResult = 4095 - rawResult        outputData[i][1] = float(rawResult / 4096.0 * 5.0)        i += 1    print outputData    # Calculate Concha Values    m, b = numpy.polyfit(outputData[:, 0], outputData[:, 1], 1) # y = mx + b    rsq = numpy.corrcoef(outputData[:, 0], outputData[:, 1])[0, 1]**2    if invalid > 0:        print "ERROR: results invalid!"    elif overflow > 0:        print "ERROR: overflow detected!"    else:        # Print results        print "Slope:         %f" % m        print "Offset [LSBs]: %d" % int(b * 4096)        print "Rsqared:       %f" % rsq    returnif __name__ == '__main__':    print 'Version: PROTO1_V01'    main()